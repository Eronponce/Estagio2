{% extends 'html/base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/base.css' %}">
{% endblock %}

{% block content %}

{% if messages %}S
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" role="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<form method="post" action="{% url 'train' %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-primary">Treinar modelo</button>
</form>
<main class="container mt-5">



    <form method="get" action="{% url 'load_instance' %}">
        {% csrf_token %}
        <div class="input-group mb-3">
            <button type="submit" class="btn btn-secondary" id="loadInstanceButton" aria-label="Load Instance">Carregar
                Instância</button>
            <select id="instanceSelect" class="form-select" name="instance_id" aria-labelledby="main-title">
                <option value="">Selecionar</option>
                {% for instance in instances %}
                <option value="{{ instance.id }}">{{ instance.name }}</option>
                {% endfor %}
            </select>
            <button type="submit" name="delete_instance" value="{{ instance.id }}" class="btn btn-danger"
                aria-label="Delete Instance">Deletar Instância</button>
        </div>
    </form>
    <form method="post" action="{% url 'save_parameters' %}">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="instanceName" class="form-label">Nome da Instância:</label>
                <input type="text" class="form-control" value="{{ instance.name }}" id="instanceName"
                    name="instance_name" required>
            </div>
            <div class="col-md-6 mb-3">
                <label for="instanceAuthor" class="form-label">Autor:</label>
                <input type="text" class="form-control" value="{{ instance.author }}" id="instanceAuthor"
                    name="instance_author" required>
            </div>
        </div>
        <div class="d-flex justify-content-between mb-3">
            <h2>Valores de Entrada</h2>
            <button type="button" id="addRow" class="btn btn-success">Adicionar Linha</button>
        </div>
        <button type="submit" class="btn btn-primary submit-button">Salvar Parâmetros</button>
        <table class="table">
            <thead>
                <tr>
                    <th>N</th>
                    <th>P</th>
                    <th>K</th>
                    <th>Temperatura C°</th>
                    <th>Umidade</th>
                    <th>pH</th>
                    <th>Chuva</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="inputRows">
                <!-- Linhas de entrada serão adicionadas aqui dinamicamente -->
                {% for parameter in parameters %}
                <tr>
                    <td><input type="number" step="0.01" value="{{ parameter.n }}" class="form-control" name="n"
                            required></td>
                    <td><input type="number" step="0.01" value="{{ parameter.p }}" class="form-control" name="p"
                            required></td>
                    <td><input type="number" step="0.01" value="{{ parameter.k }}" class="form-control" name="k"
                            required></td>
                    <td><input type="number" step="0.01" value="{{ parameter.temperature }}" class="form-control"
                            name="temperature" required></td>
                    <td><input type="number" step="0.01" value="{{ parameter.humidity }}" class="form-control"
                            name="humidity" required>
                    </td>
                    <td><input type="number" step="0.01" value="{{ parameter.ph }}" class="form-control" name="ph"
                            required>
                    </td>
                    <td><input type="number" step="0.01" value="{{ parameter.rainfall }}" class="form-control"
                            name="rainfall" required>
                    </td>


                    <td><button class="btn btn-danger remove-row" required>Remover</button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button type="submit" class="btn btn-primary submit-button" name="execute_algorithm" value="true">Executar
                Algoritmo</button>
        </div>
    </form>
    <h3>Informação de predição</h3>
    <table border="1">
        <thead>
            <tr>
                <th>Nome do modelo</th>
                <th>Predição</th>
                <th>Confiança máxima</th>
                <th>Acuracia</th>
            </tr>
        </thead>
        <tbody>
            {% for prediction in predictions_info %}
            <tr>
                <td>{{ prediction.algorithm_name }}</td>
                <td>{{ prediction.prediction.0 }}</td>
                <td>{{ prediction.max_confidence }}</td>
                <td>{{ prediction.accuracy }}</td>

            </tr>
            {% endfor %}
        </tbody>
    </table>
    <table border="1">
        <caption>Variação em Z-score: Quantos desvios padrão um valor específico está em relação à média da amostra.
        </caption>
        <caption>A variação está sendo considerada com o modelo KNN</caption>
        <thead>
            <tr>
                <th>Parâmetro</th>
                <th>N</th>
                <th>P</th>
                <th>K</th>
                <th>Temperatura C°</th>
                <th>Umidade</th>
                <th>pH</th>
                <th>Chuva</th>
            </tr>
        </thead>
        <tbody>
            {% for row in variations %}
            <tr>
                <td>Z-score</td>
                {% for cell in row %}
                <td>{{ cell }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div id="image-container">

    </div>
</main>

{% endblock %}
{% block scripts %}

<script src="{% static 'js/algorithm.js' %}"></script>
{% endblock %}
